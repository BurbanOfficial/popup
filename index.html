<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Installer l'application</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }
    /* Style minimaliste et animé du pop-up */
    #installPopup {
      position: fixed;
      bottom: -100px; /* caché initialement */
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.85);
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px 8px 0 0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
      opacity: 0;
      transition: bottom 0.5s ease-out, opacity 0.5s ease-out;
      z-index: 9999;
      display: flex;
      align-items: center;
    }
    #installPopup.show {
      bottom: 20px;
      opacity: 1;
    }
    #installPopup span {
      font-size: 16px;
    }
    #installPopup button {
      background: #00bcd4;
      border: none;
      color: #fff;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 15px;
      font-size: 14px;
    }
    #installPopup button:hover {
      background: #007c8c;
    }
  </style>
</head>
<body>

  <!-- Contenu principal de la page -->
  <div style="padding: 20px;">
    <h1>Bienvenue sur notre site</h1>
    <p>Profitez d'un accès rapide en installant notre application sur votre appareil mobile.</p>
  </div>
  
  <!-- Pop-up d'installation -->
  <div id="installPopup">
    <span id="popupMessage">Installer l'application sur votre écran d'accueil</span>
    <button id="installButton">Installer</button>
  </div>
  
  <script>
    let deferredPrompt;
    const popup = document.getElementById('installPopup');
    const installButton = document.getElementById('installButton');

    // Fonction pour détecter si l'appareil est mobile (Android, iOS, etc.)
    function isMobile() {
      return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    // Vérifier si l'utilisateur a déjà installé l'application
    const isInstalled = localStorage.getItem('pwaInstalled');

    // Ne rien faire sur desktop ou si déjà installé
    if (!isMobile() || isInstalled) {
      console.log("Installation non nécessaire sur desktop ou déjà réalisée.");
    } else {
      // Écouter l'événement beforeinstallprompt (disponible sur les navigateurs compatibles, ex. Chrome sur Android)
      window.addEventListener('beforeinstallprompt', (e) => {
        // Empêche l'apparition automatique de la mini-infobulle
        e.preventDefault();
        // Sauvegarde de l'événement pour pouvoir le déclencher plus tard
        deferredPrompt = e;
        // Afficher le pop-up après un délai de 3 secondes
        setTimeout(() => {
          popup.classList.add('show');
        }, 3000);
      });
    }

    // Au clic sur le bouton d'installation
    installButton.addEventListener('click', async () => {
      if (deferredPrompt) {
        // Déclenche l'invite d'installation native
        deferredPrompt.prompt();
        // Attendre la réponse de l'utilisateur
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          console.log('L\'utilisateur a accepté l\'installation.');
          // Marquer l'installation pour ne plus afficher le pop-up
          localStorage.setItem('pwaInstalled', 'true');
        } else {
          console.log('L\'utilisateur a refusé l\'installation.');
        }
        // Nettoyer l'événement différé
        deferredPrompt = null;
        // Masquer le pop-up
        popup.classList.remove('show');
      } else {
        // Si aucune invite n'est disponible (cas fréquent sur iOS ou navigateurs non compatibles)
        alert("L'installation automatique n'est pas prise en charge sur votre navigateur. Veuillez ajouter l'application manuellement via le menu de partage.");
      }
    });

    // Optionnel : écoute de l'événement appinstalled (si le navigateur le supporte)
    window.addEventListener('appinstalled', () => {
      console.log('Application installée avec succès.');
      localStorage.setItem('pwaInstalled', 'true');
      popup.classList.remove('show');
    });
  </script>

</body>
</html>
